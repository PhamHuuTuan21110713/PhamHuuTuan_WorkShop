<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Tạo Controller API đặt chuyến bay :: Amazon Q Developer Workshop - Build enterprise Java application with Spring Boot</title>

    
    <link href="/css/nucleus.css?1726162207" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1726162207" rel="stylesheet">
    <link href="/css/hybrid.css?1726162207" rel="stylesheet">
    <link href="/css/featherlight.min.css?1726162207" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1726162207" rel="stylesheet">
    <link href="/css/auto-complete.css?1726162207" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1726162207" rel="stylesheet">
    <link href="/css/theme.css?1726162207" rel="stylesheet">
    <link href="/css/hugo-theme.css?1726162207" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1726162207" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1726162207"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/3-module-2-flight-reservation-api/9-book-flight-api-controller/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1726162207"></script>
<script type="text/javascript" src="/js/auto-complete.js?1726162207"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1726162207"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-config-environment/" title="Thiết lập môi trường" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/">
           <b> 1. </b> Thiết lập môi trường
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/1-connecting-ec2/" title="Kết nối EC2" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/1-connecting-ec2/">
           <b> 1.1 </b> Kết nối EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/2-config-cognito/" title="Cấu hình Cognito" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/2-config-cognito/">
           <b> 1.2 </b> Cấu hình Cognito
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/3-configsns-to-send-email/" title="Cấu hình SNS topic để gửi email" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/3-configsns-to-send-email/">
           <b> 1.3 </b> Cấu hình SNS topic để gửi email
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/4-config-mysql-to-connect-rds/" title="Cấu hình MySQL Workbench để kết nối tới RDS" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/4-config-mysql-to-connect-rds/">
           <b> 1.4 </b> Cấu hình MySQL Workbench để kết nối tới RDS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/5-openning-project-intelij/" title="Mở Project trong Intelij IDE" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/5-openning-project-intelij/">
           <b> 1.5 </b> Mở Project trong Intelij IDE
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-config-environment/6-setup-amazonq/" title="Thiết lập Amazon Q Developer trong JetBrains Intelij" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-config-environment/6-setup-amazonq/">
           <b> 1.6 </b> Thiết lập Amazon Q Developer trong JetBrains Intelij
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/" title="Module 1 - API tìm chuyến bay (Find Flights API)" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/">
           <b> 2. </b> Module 1 - API tìm chuyến bay (Find Flights API)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/1-table-database-module1/" title="Thiết lập bảng cho database của Module 1" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/1-table-database-module1/">
           <b> 2.1 </b> Thiết lập bảng cho database của Module 1
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/2-model-classes-module1/" title="Xây dựng các lớp model" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/2-model-classes-module1/">
           <b> 2.2 </b> Xây dựng các lớp model
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/3-dto-module1/" title="Tạo Data Transfer Object (DTO)" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/3-dto-module1/">
           <b> 2.3 </b> Tạo Data Transfer Object (DTO)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/4-jpa-repository-interface-module1/" title="Dựng JPA Repository Interface" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/4-jpa-repository-interface-module1/">
           <b> 2.4 </b> Dựng JPA Repository Interface
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/5-config-datasource-module1/" title="Cấu hình Datasource" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/5-config-datasource-module1/">
           <b> 2.5 </b> Cấu hình Datasource
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/6-service-classes-module1/" title="Xây dựng các lớp Service" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/6-service-classes-module1/">
           <b> 2.6 </b> Xây dựng các lớp Service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/7-unit-test-repository-classes-module1/" title="Unit Testing cho các lớp Repository" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/7-unit-test-repository-classes-module1/">
           <b> 2.7 </b> Unit Testing cho các lớp Repository
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/8-unit-test-service-classes-module1/" title="Unit Test lớp service" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/8-unit-test-service-classes-module1/">
           <b> 2.8 </b> Unit Test lớp service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/9-get-cognito-pkeys-module1/" title="Lấy Cognito public keys" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/9-get-cognito-pkeys-module1/">
           <b> 2.9 </b> Lấy Cognito public keys
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/10-exception-handler-module1/" title="Xây dựng Exception Handler để xử lý các Authentication Exceptions" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/10-exception-handler-module1/">
           <b> 2.10 </b> Xây dựng Exception Handler để xử lý các Authentication Exceptions
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/11-flight-reservations-controller-classes-module1/" title="Tạo lớp FlightReservation Controller" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/11-flight-reservations-controller-classes-module1/">
           <b> 2.11 </b> Tạo lớp FlightReservation Controller
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-module-1-find-flights-api/12-unit-test-find-flights-api/" title="Unit test API tìm chuyến bay" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-module-1-find-flights-api/12-unit-test-find-flights-api/">
           <b> 2.12 </b> Unit test API tìm chuyến bay
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/" title="Module 2 - API đặt chỗ chuyến bay (Flight Reservation API)" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/">
           <b> 3. </b> Module 2 - API đặt chỗ chuyến bay (Flight Reservation API)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/1-table-database-module2/" title="Tạo bảng và load dữ liệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/1-table-database-module2/">
           <b> 3.1 </b> Tạo bảng và load dữ liệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/2-model-classes-module2/" title="Xây dựng tầng model" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/2-model-classes-module2/">
           <b> 3.2 </b> Xây dựng tầng model
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/3-jpa-repository-module2/" title="Xây dựng JPA Repository" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/3-jpa-repository-module2/">
           <b> 3.3 </b> Xây dựng JPA Repository
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/4-unit-test-repository-classes-module2/" title="Unit test cho các lớp Repository " class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/4-unit-test-repository-classes-module2/">
           <b> 3.4 </b> Unit test cho các lớp Repository 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/5-handle-bussiness-exceptions-module2/" title="Xử lý các Business Exceptions" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/5-handle-bussiness-exceptions-module2/">
           <b> 3.5 </b> Xử lý các Business Exceptions
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/6-service-classes-module2/" title="Xây dựng các lớp service" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/6-service-classes-module2/">
           <b> 3.6 </b> Xây dựng các lớp service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/7-unit-test-flightbooking-service-classes/" title="Unit Test Lớp service FlightBooking" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/7-unit-test-flightbooking-service-classes/">
           <b> 3.7 </b> Unit Test Lớp service FlightBooking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/8-dto-reservation-details/" title="Tạo chi tiết đặt chỗ DTO (DTO Reservation Details)" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/8-dto-reservation-details/">
           <b> 3.8 </b> Tạo chi tiết đặt chỗ DTO (DTO Reservation Details)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/9-book-flight-api-controller/" title="Tạo Controller API đặt chuyến bay" class="dd-item 
        
        active
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/9-book-flight-api-controller/">
           <b> 3.9 </b> Tạo Controller API đặt chuyến bay
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-module-2-flight-reservation-api/10-unit-test-reserve-flight-api/" title="Unit test cho  API đặt chỗ chuyến bay" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-module-2-flight-reservation-api/10-unit-test-reserve-flight-api/">
           <b> 3.10 </b> Unit test cho  API đặt chỗ chuyến bay
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-testing-api-with-postman/" title="Chạy thử API với Postman" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-testing-api-with-postman/">
           <b> 4. </b> Chạy thử API với Postman
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-clean-up/" title="Clean up" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-clean-up/">
           <b> 5. </b> Clean up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/3-module-2-flight-reservation-api/9-book-flight-api-controller/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/3-module-2-flight-reservation-api/9-book-flight-api-controller/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>10-09-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Phạm Tuấn</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Home</a> > <a href='/vi/3-module-2-flight-reservation-api/'>Module 2 - API đặt chỗ chuyến bay (Flight Reservation API)</a> > Tạo Controller API đặt chuyến bay
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo Controller API đặt chuyến bay
            </h1>
          

        



	<ul>
<li>Cuối cùng, thêm phương thức <strong>bookFlight</strong> vào controller được tạo trước đó để cung cấp khả năng đặt chỗ chuyến bay.</li>
<li>Mở <strong>FlightReservation.java</strong> trong thư mục <strong>src/main/java/com.airlines.catalog/controller</strong> và thêm các import mới.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Code</strong>
    <p>

import com.airlines.catalog.repository.PassengerRepository;
import com.airlines.catalog.repository.ReservationRepository;
import com.airlines.catalog.service.FlightBooking;
import com.airlines.catalog.dto.ReservationDetails;
import com.airlines.catalog.exception.FlightNotFoundException;
import com.airlines.catalog.exception.RequestedSeatsNotAvailable;
import com.airlines.catalog.model.Passenger;
import com.airlines.catalog.model.Reservation;
import org.springframework.web.bind.annotation.*;
import software.amazon.awssdk.regions.Region;
import javax.validation.Valid;
</p>
</div>

<p><img alt="image.png" src="/images/module_2/booking_controller/image.png"></p>
<ul>
<li>Tự động kết nối các service và reposity mới được tạo</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Code</strong>
    <p>
@Autowired<br>
PassengerRepository passengerRepository;<br>
@Autowired<br>
ReservationRepository reservationRepository;<br>
@Autowired<br>
FlightBooking flightBooking;
</p>
</div>

<p><img alt="image.png" src="/images/module_2/booking_controller/image_1.png"></p>
<ul>
<li>Từ bây giờ, hãy thực hiện theo cách tiếp cận từng dòng prompt để tạo đề xuất mã cho phương thức <strong>bookFlight</strong>. Sử dụng lời nhắc bên dưới để tạo phương thức controller còn lại.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

```
/* Create a rest controller bookFlight to get flight details with HTTP POST Method ,
/reserve path and request body reservationDetails. Rest controller returns a ResponseEntity of string
Authorization token is passed in the header of the request.
```

</p>
</div>

<ul>
<li>Xác thực JWT token được chuyển trong  Authorization Header.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

```
validate the token by calling verifyToken method in a try catch block. If token is valid set
  authenticated flag to true
  Catch authenticationException and return the response entity object
  from the exception object
```

</p>
</div>

<ul>
<li>Tạo <strong>Passenger</strong> Entity từ request body.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

    create passenger object assign first name, last name and gender of passenger object from reservationDetails object

</p>
</div>

<ul>
<li>Kiểm tra xem hành khách có phải là người lớn hay không.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

     Check the age from reservationDetails object and populate adult field

</p>
</div>

<ul>
<li>Tạo <strong>Reservation</strong> Entity request body. Áp dụng prompt dưới đây.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

```
create reservation object Assign flightId, travelClass, ticketPrice, currencyCode,contactEmail,
contactNumber, reservationStatus, paymentStatus, paymentMode 
```

</p>
</div>

<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

set the date reservation date in yyyy-MM-dd format and
reservation time in HH:mm:ss format for current date and time

</p>
</div>

<ul>
<li>Bây giờ, hãy thêm code bên dưới để đặt chỗ.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> Boolean result;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> noOfPassengers <span style="color:#f92672">=</span> 1;
</span></span><span style="display:flex;"><span>        Region region <span style="color:#f92672">=</span> Region.<span style="color:#a6e22e">of</span>(awsRegion);
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> FlightBooking.<span style="color:#a6e22e">reserveFlight</span>(passenger, reservation, PassengerRepository,
</span></span><span style="display:flex;"><span>                ReservationRepository, flightresultsRepository, noOfPassengers, snsTopicArn, region);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> (FlightNotFoundException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> (RequestedSeatsNotAvailable e) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><ul>
<li>Kiểm tra kết quả thực thi service và trả về phản hồi từ API.</li>
</ul>
<div style="background-color: #e7f3fe; padding: 20px;" class="callout callout-info">
    <strong>Prompt</strong>
    <p>

```
check if the reservation is successful
return response entity object with HTTP status of ok and
message "reservation made successfully" appending the reservation booking Reference number
if the reservation is not successful
return response entity object with HTTP status of bad request

```

</p>
</div>

<ul>
<li>Code hoàn chỉnh mới của lớp <strong>FlightReservation</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.airlines.catalog.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.channels.ScatteringByteChannel;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.dto.FlightDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.exception.AuthenticationException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.repository.AirportRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.repository.FlightRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.service.FlightDetailsService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.auth0.jwt.JWT;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.auth0.jwt.JWTVerifier;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.auth0.jwt.algorithms.Algorithm;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.auth0.jwt.interfaces.DecodedJWT;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Value;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.http.HttpStatus;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.http.ResponseEntity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestHeader;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestParam;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.repository.PassengerRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.repository.ReservationRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.service.FlightBooking;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.dto.ReservationDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.exception.FlightNotFoundException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.exception.RequestedSeatsNotAvailable;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.model.Passenger;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.airlines.catalog.model.Reservation;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> software.amazon.awssdk.regions.Region;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.validation.Valid;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FlightReservation</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    FlightRepository flightresultsRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    AirportRepository airportresultsRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    FlightDetailsService FlightDetailsService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    PassengerRepository passengerRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    ReservationRepository reservationRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    FlightBooking flightBooking;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${cognito.userpool.id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String cognitoUserPoolId;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${aws.region}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String awsRegion;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${sns.arn}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String snsTopicArn;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Create a private method verifyToken to verify JWT token with input parameters as
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Cognito user pool id, AWS region and token string. Function returns a Boolean.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Construct the Cognito well known url and then verify the token using RSA Algorithm.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    catch all Exception throw new authenticationException.*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Boolean <span style="color:#a6e22e">verifyToken</span>(String cognitoUserPoolId, String awsRegion, String token) <span style="color:#66d9ef">throws</span> AuthenticationException {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;token=&#34;</span> <span style="color:#f92672">+</span> token);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            String cognitoWellKnownUrl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://cognito-idp.&#34;</span> <span style="color:#f92672">+</span> awsRegion <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.amazonaws.com/&#34;</span> <span style="color:#f92672">+</span> cognitoUserPoolId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/.well-known/jwks.json&#34;</span>;
</span></span><span style="display:flex;"><span>            Algorithm algorithm <span style="color:#f92672">=</span> Algorithm.<span style="color:#a6e22e">RSA256</span>(<span style="color:#66d9ef">new</span> AwsCognitoRSAKeyProvider(cognitoWellKnownUrl));
</span></span><span style="display:flex;"><span>            JWTVerifier verifier <span style="color:#f92672">=</span> JWT.<span style="color:#a6e22e">require</span>(algorithm).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>            DecodedJWT decodedJWT <span style="color:#f92672">=</span> verifier.<span style="color:#a6e22e">verify</span>(token);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> AuthenticationException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Create a rest controller getFlightDetails to get flight details with HTTP GET Method ,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   /flight path and request parameters as departure date, departure airport code and arrival airport code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   JWT Token in the Authorization Header.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   Rest controller returns a ResponseEntity of string.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/flight&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getFlightDetails</span>(<span style="color:#a6e22e">@RequestParam</span>(<span style="color:#e6db74">&#34;departureDate&#34;</span>) String departureDate,
</span></span><span style="display:flex;"><span>                                                   <span style="color:#a6e22e">@RequestParam</span>(<span style="color:#e6db74">&#34;departureAirportCode&#34;</span>) String departureAirportCode,
</span></span><span style="display:flex;"><span>                                                   <span style="color:#a6e22e">@RequestParam</span>(<span style="color:#e6db74">&#34;arrivalAirportCode&#34;</span>) String arrivalAirportCode,
</span></span><span style="display:flex;"><span>                                                   <span style="color:#a6e22e">@RequestHeader</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>) String authorization) <span style="color:#66d9ef">throws</span> AuthenticationException {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* Call verifyToken method, catch authentication exception and return the responseEntity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    if token is valid and call the findFlights method in FlightDetailsService class
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    with input parameters  departure date, departure airport code,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    arrival airport code, flightResultsRepository and airportResultsRepository.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    If flights are found return the list of flights otherwise return &#34;No flights found&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    If authentication failed the return &#34;Authentication failed&#34; and HTTP status of forbidden
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (verifyToken(cognitoUserPoolId, awsRegion, authorization)) {
</span></span><span style="display:flex;"><span>                List<span style="color:#f92672">&lt;</span>FlightDetails<span style="color:#f92672">&gt;</span> flights <span style="color:#f92672">=</span> FlightDetailsService.<span style="color:#a6e22e">findFlights</span>(departureDate, departureAirportCode, arrivalAirportCode, flightresultsRepository, airportresultsRepository);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (flights.<span style="color:#a6e22e">size</span>() <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(flights.<span style="color:#a6e22e">toString</span>(), HttpStatus.<span style="color:#a6e22e">OK</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;No flights found&#34;</span>, HttpStatus.<span style="color:#a6e22e">OK</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;Authentication failed&#34;</span>, HttpStatus.<span style="color:#a6e22e">FORBIDDEN</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (AuthenticationException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* Create a rest controller bookFlight to get flight details with HTTP POST Method ,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/reserve path and request body reservationDetails. Rest controller returns a ResponseEntity of string.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Authorization token is passed in the header of the request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/reserve&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">bookFlight</span>(<span style="color:#a6e22e">@Valid</span> <span style="color:#a6e22e">@RequestBody</span> ReservationDetails reservationDetails, <span style="color:#a6e22e">@RequestHeader</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>) String authorization) <span style="color:#66d9ef">throws</span>
</span></span><span style="display:flex;"><span>            FlightNotFoundException, RequestedSeatsNotAvailable {
</span></span><span style="display:flex;"><span>        ResponseEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> responseEntity <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">/*validate the token by calling verifyToken method in a try catch block. If token is valid set
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         authenticated flag to true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         Catch authenticationException and return the response entity object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         from the exception object */</span>
</span></span><span style="display:flex;"><span>        Boolean authenticated <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            authenticated <span style="color:#f92672">=</span> verifyToken(cognitoUserPoolId, awsRegion, authorization);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (AuthenticationException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>authenticated) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;Authentication failed&#34;</span>, HttpStatus.<span style="color:#a6e22e">FORBIDDEN</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* create passenger object assign first name, last name and gender of passenger object from reservationDetails object */</span>
</span></span><span style="display:flex;"><span>        Passenger passenger <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Passenger();
</span></span><span style="display:flex;"><span>        passenger.<span style="color:#a6e22e">setFirstName</span>(reservationDetails.<span style="color:#a6e22e">getFirstName</span>());
</span></span><span style="display:flex;"><span>        passenger.<span style="color:#a6e22e">setLastName</span>(reservationDetails.<span style="color:#a6e22e">getLastName</span>());
</span></span><span style="display:flex;"><span>        passenger.<span style="color:#a6e22e">setGender</span>(reservationDetails.<span style="color:#a6e22e">getGender</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Check the age from reservationDetails object and populate adult field</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (reservationDetails.<span style="color:#a6e22e">getAge</span>() <span style="color:#f92672">&gt;=</span> 18) {
</span></span><span style="display:flex;"><span>            passenger.<span style="color:#a6e22e">setAdult</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* create reservation object Assign flightId, travelClass, ticketPrice, currencyCode,contactEmail,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        contactNumber, reservationStatus, paymentStatus, paymentMode */</span>
</span></span><span style="display:flex;"><span>        Reservation reservation <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Reservation();
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setFlightId</span>(reservationDetails.<span style="color:#a6e22e">getFlightId</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setTravelClass</span>(reservationDetails.<span style="color:#a6e22e">getTravelClass</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setTicketPrice</span>(reservationDetails.<span style="color:#a6e22e">getTicketPrice</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setCurrencyCode</span>(reservationDetails.<span style="color:#a6e22e">getCurrencyCode</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setContactEmail</span>(reservationDetails.<span style="color:#a6e22e">getContactEmail</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setContactNumber</span>(reservationDetails.<span style="color:#a6e22e">getContactNumber</span>());
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setReservationStatus</span>(<span style="color:#e6db74">&#34;CONFIRMED&#34;</span>);
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setPaymentStatus</span>(<span style="color:#e6db74">&#34;PAID&#34;</span>);
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setPaymentMode</span>(reservationDetails.<span style="color:#a6e22e">getPaymentMode</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* set the date reservation date in yyyy-MM-dd format and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        reservation time in HH:mm:ss format for current date and time*/</span>
</span></span><span style="display:flex;"><span>        java.<span style="color:#a6e22e">util</span>.<span style="color:#a6e22e">Date</span> utilDate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> java.<span style="color:#a6e22e">util</span>.<span style="color:#a6e22e">Date</span>();
</span></span><span style="display:flex;"><span>        java.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">SimpleDateFormat</span> dateFormat <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> java.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">SimpleDateFormat</span>(<span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span>);
</span></span><span style="display:flex;"><span>        java.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">SimpleDateFormat</span> timeFormat <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> java.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">SimpleDateFormat</span>(<span style="color:#e6db74">&#34;HH:mm:ss&#34;</span>);
</span></span><span style="display:flex;"><span>        String date <span style="color:#f92672">=</span> dateFormat.<span style="color:#a6e22e">format</span>(utilDate);
</span></span><span style="display:flex;"><span>        String time <span style="color:#f92672">=</span> timeFormat.<span style="color:#a6e22e">format</span>(utilDate);
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setReservationDate</span>(date);
</span></span><span style="display:flex;"><span>        reservation.<span style="color:#a6e22e">setReservationTime</span>(time);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Boolean result;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> noOfPassengers <span style="color:#f92672">=</span> 1;
</span></span><span style="display:flex;"><span>            Region region <span style="color:#f92672">=</span> Region.<span style="color:#a6e22e">of</span>(awsRegion);
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> flightBooking.<span style="color:#a6e22e">reserveFlight</span>(passenger, reservation, passengerRepository,
</span></span><span style="display:flex;"><span>                    reservationRepository, flightresultsRepository, noOfPassengers, snsTopicArn, region);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (FlightNotFoundException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (RequestedSeatsNotAvailable e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> e.<span style="color:#a6e22e">getResponseEntity</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/* check if the reservation is successful
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 return response entity object with HTTP status of ok and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                message &#34;reservation made successfully&#34; appending the booking Reference
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                if the reservation is not successful
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                return response entity object with HTTP status of Internal Server Error */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (result) {
</span></span><span style="display:flex;"><span>            responseEntity <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;Reservation made successfully. Booking Reference: &#34;</span> <span style="color:#f92672">+</span> reservation.<span style="color:#a6e22e">getBookingReference</span>(), HttpStatus.<span style="color:#a6e22e">OK</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            responseEntity <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;Reservation failed&#34;</span>, HttpStatus.<span style="color:#a6e22e">INTERNAL_SERVER_ERROR</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> responseEntity;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-module-2-flight-reservation-api/8-dto-reservation-details/" title="Tạo chi tiết đặt chỗ DTO (DTO Reservation Details)"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/3-module-2-flight-reservation-api/10-unit-test-reserve-flight-api/" title="Unit test cho  API đặt chỗ chuyến bay" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1726162207"></script>
    <script src="/js/perfect-scrollbar.min.js?1726162207"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1726162207"></script>
    <script src="/js/jquery.sticky.js?1726162207"></script>
    <script src="/js/featherlight.min.js?1726162207"></script>
    <script src="/js/highlight.pack.js?1726162207"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1726162207"></script>
    <script src="/js/learn.js?1726162207"></script>
    <script src="/js/hugo-learn.js?1726162207"></script>

    <link href="/mermaid/mermaid.css?1726162207" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1726162207"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
